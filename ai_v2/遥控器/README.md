# 遥控器接口文档集

本目录包含了所有与遥控器端相关的 Socket.io 接口文档，用于指导开发人员实现遥控器与服务器/GPU主机之间的通信和控制。

## 文档概述

这些文档详细描述了遥控器系统中各个组件之间的通信接口，基于 Socket.io 技术实现实时数据传输和控制。

## 文档列表

| 文档名称 | 描述 |
|---------|------|
| [查询指令.md](查询指令.md) | 遥控器与服务器之间的查询指令和响应，用于获取系统资源信息 |
| [GPU控制指令.md](GPU控制指令.md) | 遥控器与GPU主机之间的控制指令和响应，用于启动和停止体育测试项目 |
| [数据操作指令.md](数据操作指令.md) | 遥控器与服务器之间的数据操作指令和响应，用于实现数据的增删改查操作 |

## 通用连接方式

所有遥控器接口使用相同的连接地址和方式：

- **URL**: `wss://gs.classtao.cn/all`
- **传输协议**: WebSocket
- **连接参数**:
  - `school_id` (String, 必填): 学校唯一标识符
  - `type` (String, 必填): 客户端类型，遥控器端应设置为 `"control_web"`

**连接示例**:
```javascript
const socket = io("wss://gs.classtao.cn/all", {
  transports: ["websocket"],
  query: {
    school_id: "677e4cf2d711833b9a143096",
    type: "control_web"
  }
});
```

## 通信格式

Socket.io 消息遵循以下格式：
```
42/all,["message",{具体消息内容}]
```

其中消息内容需包含以下字段：
- `action` (String, 必填): 操作标识
- `from` (String, 必填): 发送方标识，通常为 `"control_web"` 或客户端的 `socket.id`
- `to` (Array, 必填): 接收方标识数组
  - 发送给服务器时为 `["server"]`
  - 发送给GPU主机时为 `["{gpu_hardware_id}"]`
- `time` (Number, 必填): 请求时间戳（毫秒），可使用 `Date.now()`
- `data` (Object, 必填): 操作的具体数据

## 接收响应

socket.on("message", callback) 用于接收所有响应消息。响应消息具有以下特点：

- `action`: 通常为 `"{原始操作}_response"`，如 "get_camera_list_response"
- `status`: "success" 或 "error" 表示操作结果
- `message`: 响应描述信息
- `data`: 响应的具体数据

## 注意事项

1. **连接状态管理**: 实现连接断开自动重连机制
2. **错误处理**: 适当处理网络错误、超时和服务器返回的错误信息
3. **安全考虑**: 验证接收的消息来源，避免处理非预期来源的消息
4. **资源释放**: 在应用退出时主动断开连接

## 更新日志

### v1.1 (2025年4月20日)
- 新增数据操作指令文档，支持数据的增删改查操作

### v1.0 (2025年4月16日)
- 初始版本发布
- 包含查询指令和GPU控制指令文档 