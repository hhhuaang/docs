### 引体向上服务调用使用文档

#### 目录

1. [安装](#1-安装)
2. [连接 Socket.IO 服务器](#2-连接-socketio-服务器)
3. [发送消息](#3-发送消息)
    - [join](#31-join)
    - [camera](#32-camera)
    - [determin](#33-determin)
4. [监听消息](#4-监听消息)
    - [state_add_camera](#41-state_add_camera)
    - [state_start_determine](#42-state_start_determine)
    - [face_determine](#43-face_determine)
    - [score_determine](#44-score_determine)

### 1. 安装

首先，安装 Socket.IO 客户端库，具体安装方式取决于您选择的编程语言。

- **JavaScript**: 使用 [socket.io-client](https://github.com/socketio/socket.io-client) 库。
- **Java**: 可以使用 [socket.io-client-java](https://github.com/socketio/socket.io-client-java) 库。
- **C++**: 使用 [socket.io-client-cpp](https://github.com/socketio/socket.io-client-cpp) 库。
- **Swift**: 可以使用 [socket.io-client-swift](https://github.com/socketio/socket.io-client-swift) 库。
- **Dart**: 使用 [socket.io-client-dart](https://github.com/rikulo/socket.io-client-dart) 库。
- **Python**: 可以使用 [python-socketio](https://github.com/miguelgrinberg/python-socketio) 库。
- **.NET**: 使用 [socket.io-client-csharp](https://github.com/doghappy/socket.io-client-csharp) 库。
- **Rust**: 可以使用 [rust-socketio](https://github.com/1c3t3a/rust-socketio) 库。
- **PHP**: 使用 [elephant.io](https://github.com/ElephantIO/elephant.io) 库。

### 2. 连接 Socket.IO 服务器

在代码中，使用 Socket.IO 客户端库连接到引体向上服务的地址，例如：

```javascript
const io = require('socket.io-client');
const socket = io('https://gs.classtao.cn/yintixiangshang');
```

### 3. 发送消息

客户端可以向服务器发送以下类型的消息，每种消息类型都有其特定的作用和参数要求。

#### 3.1. join

**作用：** 发送加入房间的消息。

| 参数名   | 描述             | 类型   |
|----------|------------------|--------|
| roomId   | 房间的唯一标识符 | 字符串 |

**参数示例：**
```json
{"roomId":"2e135416c5bbb9d1f6a9be61a1130d1f"}
```

#### 3.2. camera

**作用：** 发送摄像头相关操作的消息。

| 参数名     | 描述             | 类型   |
|------------|------------------|--------|
| action     | 操作类型         | 字符串 |
| roomId     | 房间的唯一标识符 | 字符串 |
| name       | 摄像头名称       | 字符串 |
| cameraId   | 摄像头的唯一标识符 | 字符串 |
| host       | 摄像头的主机地址 | 字符串 |
| channel    | 摄像头的通道     | 字符串 |
| username   | 登录摄像头的用户名 | 字符串 |
| password   | 登录摄像头的密码 | 字符串 |
| rtspuser   | RTSP 用户名（如果适用） | 字符串 |
| rtsppswd   | RTSP 密码（如果适用） | 字符串 |
| face       | 人脸识别模块名称 | 字符串 |
| mark       | 标记点的坐标数组 | 数组 |

**参数示例：**
```json
{
  "action": "add",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
  "name": "公司1",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "host": "192.168.31.142",
  "channel": "1",
  "username": "admin",
  "password": "129289aC!",
  "rtspuser": "hxx",
  "rtsppswd": "129289aC!",
  "face": "face",
  "mark": [[190,916],[797,1045],[92,279],[767,263],[1059,935],[1674,1031],[1074,258],[1748,266]]
}
```

#### 3.3. determin

**作用：** 发送人脸识别相关的消息，包括开始人脸识别和人脸识别结果。

| 参数名     | 描述             | 类型   |
|------------|------------------|--------|
| roomId     | 房间的唯一标识符 | 字符串 |
| action     | 操作类型         | 字符串 |
| cameraId   | 摄像头的唯一标识符 | 字符串 |
| data       | 识别结果数据     | 对象   |

**参数示例（开始人脸识别）：**
```json
{
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
  "action": "start",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**参数示例（人脸识别失败）：**
```json
{
  "action": "user",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "data": {
    "num": 1,
    "state": "fail"
  }
}
```

**参数示例（人脸识别成功）：**
```json
{
  "action": "user",
  "roomId": "2e135416c5bbb9d1f6a9be61a113

0d1f",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "data": {
    "num": 1,
    "state": "success",
    "name": "黄晓旭",
    "id": "sdf32d2d2d2323d223"
  }
}
```

### 4. 监听消息

客户端可以监听以下类型的服务器发送的消息，每种消息类型都有其特定的作用和参数。

#### 4.1. state_add_camera

**作用：** 监听摄像头添加状态的消息。

| 参数名   | 描述             | 类型   |
|----------|------------------|--------|
| action   | 操作类型         | 字符串 |
| id       | 摄像头的唯一标识符 | 字符串 |
| state    | 添加状态         | 字符串 |
| roomId   | 房间的唯一标识符 | 字符串 |

**参数示例：**
```json
{
  "action": "state_add",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "success",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f"
}
```

#### 4.2. state_start_determine

**作用：** 监听引体向上分析开始状态的消息。

| 参数名   | 描述             | 类型   |
|----------|------------------|--------|
| action   | 操作类型         | 字符串 |
| state    | 分析开始状态     | 字符串 |
| id       | 摄像头的唯一标识符 | 字符串 |
| roomId   | 房间的唯一标识符 | 字符串 |

**参数示例：**
```json
{
  "action": "state_start",
  "state": "success",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f"
}
```

#### 4.3. face_determine

**作用：** 监听人脸识别失败的消息。

| 参数名   | 描述             | 类型   |
|----------|------------------|--------|
| action   | 操作类型         | 字符串 |
| num      | 序号             | 数字   |
| data     | 识别数据         | 字符串 |
| id       | 摄像头的唯一标识符 | 字符串 |
| roomId   | 房间的唯一标识符 | 字符串 |

**参数示例：**
```json
{
  "action": "face",
  "num": 1,
  "data": "data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAIBAK9T//Z",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f"
}
```

#### 4.4. score_determine

**作用：** 监听成绩改变的消息。

| 参数名   | 描述             | 类型   |
|----------|------------------|--------|
| action   | 操作类型         | 字符串 |
| message  | 消息类型         | 字符串 |
| data     | 成绩数据         | 数组   |
| video    | 视频文件地址     | 字符串 |
| id       | 摄像头的唯一标识符 | 字符串 |
| roomId   | 房间的唯一标识符 | 字符串 |

**参数示例（成绩改变）：**
```json
{
  "action": "score",
  "message": "change",
  "data": [
    {
      "name": "No.1",
      "number": 1,
      "score": 1,
      "standard": 1,
      "defect": 0,
      "Incomplete": 0,
      "startTime": 1712912974.9035609,
      "endTime": null,
      "video": null
    },
    {
      "name": "No.2",
      "number": 2,
      "score": 0,
      "standard": 0,
      "defect": 0,
      "Incomplete": 0,
      "startTime": null,
      "endTime": null,
      "video": null
    }
  ],
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f"
}
```

**参数示例（所有人员结束）：**
```json
{
  "action": "score",
  "message": "stop",
  "data": [
    {
      "name": "No.1",
      "number": 1,
      "score": 1,
      "standard": 1,
      "defect": 0,
      "Incomplete": 0,
      "startTime": 1712912974.9035609,
      "endTime": 1712912982.5028145,
      "video": null
    },
    {
      "name": "No.2",
      "number": 2,
      "score": 6,
      "standard": 5,
      "defect": 1,
      "Incomplete": 0,
      "startTime": 1712912991.6838424,
      "endTime": 1712913019.3549309,
      "video": null
    }
  ],
  "video": null,
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f"
}
```

**参数示例（所有人员结束并上传视频）：**
```json
{
  "action": "score",
  "message": "end",
  "data": [
    {
      "name": "No.1",
      "number": 1,
      "score": 1,
      "standard": 1,
      "defect": 0,
      "Incomplete": 0,
      "startTime": 1712912974.

9035609,
      "endTime": 1712912982.5028145,
      "video": "https://zhihuicaochang.oss-cn-hangzhou.aliyuncs.com/yintixiangshang/638fc67985f36bc6a4209b05143fc3b4No.1.mp4"
    },
    {
      "name": "No.2",
      "number": 2,
      "score": 6,
      "standard": 5,
      "defect": 1,
      "Incomplete": 0,
      "startTime": 1712912991.6838424,
      "endTime": 1712913019.3549309,
      "video": "https://zhihuicaochang.oss-cn-hangzhou.aliyuncs.com/yintixiangshang/638fc67985f36bc6a4209b05143fc3b4No.2.mp4"
    }
  ],
  "video": null,
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f"
}
```
