# 工具服务调用使用文档

## 目录
1. [安装](#1-安装)
2. [连接 Socket.IO 服务器](#2-连接-socketio-服务器)
3. [发送消息](#3-发送消息)
   1. [join](#31-join)
   2. [ 摄像头相关](#32-camera)
      1. [添加摄像头](#321-add)
      2. [删除摄像头](#322-delete)
      3. [摄像头喊话](#323-speak)
      4. [摄像头转到预设角](#324-goto)
      5. [开始录像](#325-start_record)
      6. [停止录像](#326-stop_record)
      7. [截图](#327-frame)
   3. [ 程序管理相关 ](#33-program)
      1. [启动程序](#331-start)
      2. [停止程序](#332-stop)
      3. [重启程序](#333-restart)
      4. [已启动程序状态](#334-status)
      5. [程序状态](#335-state)
4. [监听消息](#4-监听消息)
   1. [建立连接](#41-connect)
   2. [断开连接](#42-disconnect)
   3. [添加摄像头](#43-state_add_camera)
   4. [删除摄像头](#44-state_delete_camera)
   5. [预设角列表](#45-state_presets_camera)
   6. [截图](#46-state_frame_camera)
   7. [上传进度](#45-state_upload_record_camera)
   8. [结束录制](#45-state_record_end_camera)
   9. [开始录制](#45-state_record_start_camera)

## 1. 安装

首先，安装 Socket.IO 客户端库，具体安装方式取决于您选择的编程语言：

- **JavaScript**: 使用 [socket.io-client](https://github.com/socketio/socket.io-client) 库。
- **Java**: 可以使用 [socket.io-client-java](https://github.com/socketio/socket.io-client-java) 库。
- **C++**: 使用 [socket.io-client-cpp](https://github.com/socketio/socket.io-client-cpp) 库。
- **Swift**: 可以使用 [socket.io-client-swift](https://github.com/socketio/socket.io-client-swift) 库。
- **Dart**: 使用 [socket.io-client-dart](https://github.com/rikulo/socket.io-client-dart) 库。
- **Python**: 可以使用 [python-socketio](https://github.com/miguelgrinberg/python-socketio) 库。
- **.NET**: 使用 [socket.io-client-csharp](https://github.com/doghappy/socket.io-client-csharp) 库。
- **Rust**: 可以使用 [rust-socketio](https://github.com/1c3t3a/rust-socketio) 库。
- **PHP**: 使用 [elephant.io](https://github.com/ElephantIO/elephant.io) 库。

## 2. 连接 Socket.IO 服务器

在代码中，使用 Socket.IO 客户端库连接到引体向上服务的地址，例如：

```javascript
const io = require('socket.io-client');
const socket = io('https://gs.classtao.cn/tools');
```

## 3. 发送消息

客户端可以向服务器发送以下类型的消息，每种消息类型都有其特定的作用和参数要求。

### 3.1. join

**作用：** 发送加入房间的消息。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "roomId":"2e135416c5bbb9d1f6a9be61a1130d1f"
}
```

### 3.2. camera

**作用：** 发送摄像头相关操作的消息。

#### 3.2.1. add

**作用：** 添加摄像头

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，可以是 "add"（添加）或其他自定义操作。|
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| name       | 字符串 (String)| 摄像头名称。                               |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |
| host       | 字符串 (String)| 摄像头的主机地址。                        |
| channel    | 字符串 (String)| 摄像头的通道。                            |
| username   | 字符串 (String)| 登录摄像头的用户名。                      |
| password   | 字符串 (String)| 登录摄像头的密码。                        |
| rtspuser   | 字符串 (String) 或 null | RTSP 用户名（如果适用）。          |
| rtsppswd   | 字符串 (String) 或 null | RTSP 密码（如果适用）。            |
| face       | 字符串 (String) 或 null | 是否开启人脸识别，有值表示开启。    |
| mark       | 数组 (Array)   | 标记点的坐标数组。                        |

**参数示例：**
```json
{
  "action": "add",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
  "name": "公司1",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "host": "192.168.31.142",
  "channel": "1",
  "username": "admin",
  "password": "129289aC!",
  "rtspuser": "hxx",
  "rtsppswd": "129289aC!",
  "face": "face",
  "mark": [[190,916],[797,1045],[92,279],[767,263],[1059,935],[1674,1031],[1074,258],[1748,266]]
}
```

**JavaScript例子：**
```javascript
  // 添加摄像头
  socket.emit("camera", {
    "action": "add",
    "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
    "name": "公司1",
    "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
    "host": "192.168.31.142",
    "channel": "1",
    "username": "admin",
    "password": "129289aC!",
    "rtspuser": "hxx",
    "rtsppswd": "129289aC!",
    "face": "face",
    "mark": [[190,916],[797,1045],[92,279],[767,263],[1059,935],[1674,1031],[1074,258],[1748,266]]
  });
```

#### 3.2.1. delete

**作用：** 删除摄像头

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "delete"。                |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |

**参数示例：**
```json
{
  "action":"delete",
  "roomId":"2e135416c5bbb9d1f6a9be61a1130d1f",
  "cameraId":"de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**JavaScript例子：**
```javascript
  // 添加摄像头
  socket.emit("camera", {
    "action": "delete",
    "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
    "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  });
```
好的，下面是完整的工具服务调用使用文档的后续部分：

---

#### 3.2.3. speak

**作用：** 让摄像头发声

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "speak"。                |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |
| message    | 字符串 (String)| 要发送的喊话内容。                        |

**参数示例：**
```json
{
  "action": "speak",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "txt": "测试音频输出是否正常"
}
```

**JavaScript例子：**
```javascript
// 摄像头喊话
socket.emit("camera", {
  "action": "speak",
  "txt": "测试音频输出是否正常",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
});

```

#### 3.2.4. goto

**作用：** 摄像头转到预设角

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "goto"。                 |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |
| preset     | 字符串 (String)| 预设角的名称。                            |

**参数示例：**
```json
{
  "action": "goto",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "preset": "立定跳远"
}
```

**JavaScript例子：**
```javascript
// 摄像头转到预设角
socket.emit("camera", {
  "action": "goto",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "preset": "立定跳远"
});
```


#### 3.2.5. start_record

**作用：** 开始录像

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "start_record"。         |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |

**参数示例：**
```json
{
  "action": "start_record",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**JavaScript例子：**
```javascript
// 开始录像
socket.emit("camera", {
  "action": "start_record",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
});
```



#### 3.2.6. stop_record

**作用：** 停止录像

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "stop_record"。          |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |

**参数示例：**
```json
{
  "action": "stop_record",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**JavaScript例子：**
```javascript
// 停止录像
socket.emit("camera", {
  "action": "stop_record",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
});
```

#### 3.2.7. frame

**作用：** 截图

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "frame"。                |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |

**参数示例：**
```json
{
  "action": "frame",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**JavaScript例子：**
```javascript
// 截图
socket.emit("camera", {
  "action": "frame",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
});
```


### 3.3. 程序管理相关

**作用：** 发送程序管理相关操作的消息。

#### 3.3.1. 启动程序

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "start"。                |
| programId  | 字符串 (String)| 程序的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "start",
  "programId": "your-program-id"
}
```

**JavaScript例子：**
```javascript
// 启动程序
socket.emit("program", {
  "action": "start",
  "programId": "your-program-id"
});
```

#### 3.3.2. 停止程序

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "stop"。                 |
| programId  | 字符串 (String)| 程序的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "stop",
  "programId": "your-program-id"
}
```

**JavaScript例子：**
```javascript
// 停止程序
socket.emit("program", {
  "action": "stop",
  "programId": "your-program-id"
});
```

#### 3.3.3. 重启程序

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "restart"。              |
| programId  | 字符串 (String)| 程序的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "restart",
  "programId": "your-program-id"
}
```

**JavaScript例子：**
```javascript
// 重启程序
socket.emit("program", {
  "action": "restart",
  "programId": "your-program-id"
});
```

#### 3.3.4. 已启动程序状态

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "status"。               |
| programId  | 字符串 (String)| 程序的唯一标识符

。                        |

**参数示例：**
```json
{
  "action": "status",
  "programId": "your-program-id"
}
```

**JavaScript例子：**
```javascript
// 查询程序状态
socket.emit("program", {
  "action": "status",
  "programId": "your-program-id"
});
```


## 4. 监听消息

客户端可以监听以下类型的消息，以获取服务器发送的状态更新或结果信息。

### 4.1. connect

**作用：** 建立连接。


### 4.2. disconnect

**作用：** 连接断开。


### 4.3. state_add_camera

**作用：** 添加摄像头。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_add"。            |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String) 或 null | 消息，只在状态为 "fail" 时存在。     |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_add",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "success",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_add",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "fail",
  "message": "没有找到对应的摄像头",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.4. state_delete_camera

**作用：** 删除摄像头。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_delete"。         |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String) 或 null | 消息，只在状态为 "fail" 时存在。     |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_delete",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "success",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_delete",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "fail",
  "message": "没有找到对应的摄像头",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.5. state_presets_camera

**作用：** 获取摄像头的预设角列表。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_presets"。        |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String)| 消息，描述请求结果。                      |
| data       | 数组 (Array)   | 包含预设角的信息列表。                     |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_presets",
  "state": "success",
  "message": "预设角列表",
  "data": [
    {"enabled": "true", "id": "1", "presetName": "立定跳远", "AbsoluteHigh": {"elevation": "260", "azimuth": "1718", "absoluteZoom": "17"}},
    {"enabled": "true", "id": "2", "presetName": "仰卧起坐", "AbsoluteHigh": {"elevation": "301", "azimuth": "1802", "absoluteZoom": "17"}},
    {"enabled": "true", "id": "3", "presetName": "引体向上", "AbsoluteHigh": {"elevation": "133", "azimuth": "1742", "absoluteZoom": "13"}},
    {"enabled": "true", "id": "4", "presetName": "测试", "AbsoluteHigh": {"elevation": "484", "azimuth": "1667", "absoluteZoom": "15"}},
    {"enabled": "true", "id": "5", "presetName": "立定跳远1", "AbsoluteHigh": {"elevation": "186", "azimuth": "2063", "absoluteZoom": "15"}},
    {"enabled": "true", "id": "6", "presetName": "跳山羊", "AbsoluteHigh": {"elevation": "490", "azimuth": "1798", "absoluteZoom": "10"}},
    {"enabled": "true", "id": "7", "presetName": "实心球", "AbsoluteHigh": {"elevation": "252", "azimuth": "1568", "absoluteZoom": "13"}},
    {"enabled": "true", "id": "8", "presetName": "摸高", "AbsoluteHigh": {"elevation": "146", "azimuth": "1772", "absoluteZoom": "11"}},
    {"enabled": "true", "id": "9", "presetName": "录像", "AbsoluteHigh": {"elevation": "236", "azimuth": "1876", "absoluteZoom": "10"}},
    {"enabled": "true", "id": "10", "presetName": "前滚翻", "AbsoluteHigh": {"elevation": "490", "azimuth": "1798", "absoluteZoom": "10"}}
  ],
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_presets",
  "state": "fail",
  "message": "未能获取预设角列表",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.6. state_frame_camera

**作用：** 获取摄像头的截图状态。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_frame"。          |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String)| 消息，描述请求结果，仅在失败时存在。     |
| url        | 字符串 (String)| 成功时返回截图的 URL。                    |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_frame",
  "state": "success",
  "url": "https://zhihuicaochang.oss-cn-hangzhou.aliyuncs.com/record/mark1727342585874.jpg",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_frame",
  "state": "fail",
  "message": "没有找到对应的摄像头",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.7. state_upload_record_camera

**作用：** 监听录制视频上传的进度。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_upload_record"。  |
| process    | 数字 (Number)  | 上传进度百分比（0-100）。                 |
| current    | 数字 (Number)  | 当前已上传的数据量（字节）。              |
| total      | 数字 (Number)  | 总数据量（字节）。                        |
| sport      | 字符串 (String)| 运动类型或相关信息。                      |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "state_upload_record",
  "process": 20,
  "current": 147456,
  "total": 733546,
  "sport": "tools",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.8. state_record_end_camera

**作用：** 监听录像结束的状态和视频链接。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_record_end"。     |
| video_url  | 字符串 (String)| 录像结束后视频的链接。                    |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_record_end",
  "video_url": "https://zhihuicaochang.oss-cn-hangzhou.aliyuncs.com/record/1873e511bf4a2e14f7230dbb3a532bc3record.mp4",
  "state": "success",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_record_end",
  "video_url": null,
  "state": "fail",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "message": "录像过程中发生错误"
}
```

### 4.9. state_start_record_camera

**作用：** 监听录像开始的状态。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_start_record"。   |
| name       | 字符串 (String)| 录像文件的名称。                          |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_start_record",
  "name": "1873e511bf4a2e14f7230dbb3a532bc3record.mp4",
  "state": "success",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_start_record",
  "name": null,
  "state": "fail",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "message": "录像开始失败"
}
```

