# 工具服务调用使用文档

## 目录
1. [安装](#1-安装)
2. [连接 Socket.IO 服务器](#2-连接-socketio-服务器)
3. [发送消息](#3-发送消息)
   1. [加入房间](#31-join)
   2. [ 摄像头相关](#32-camera)
      1. [添加摄像头](#321-add)
      2. [删除摄像头](#322-delete)
      3. [摄像头喊话](#323-speak)
      4. [摄像头转到预设角](#324-goto)
      5. [开始录像](#325-start_record)
      6. [停止录像](#326-stop_record)
      7. [截图](#327-frame)
   3. [ 程序管理相关 ](#33-program)
      1. [启动程序](#331-start)
      2. [停止程序](#332-stop)
      3. [重启程序](#333-restart)
      4. [已启动程序状态](#334-status)
      5. [程序状态](#335-state)
4. [监听消息](#4-监听消息)
   1. [建立连接](#41-connect)
   2. [断开连接](#42-disconnect)
   3. [添加摄像头](#43-state_add_camera)
   4. [删除摄像头](#44-state_delete_camera)
   5. [预设角列表](#45-state_presets_camera)
   6. [截图](#46-state_frame_camera)
   7. [上传进度](#45-state_upload_record_camera)
   8. [结束录制](#45-state_record_end_camera)
   9. [开始录制](#45-state_record_start_camera)
   10. [加入房间](#45-state_join)
   11. [启动程序](#411-state_start_program)  
   12. [停止程序](#412-state_stop_program)  
   13. [重启程序](#413-state_restart_program)  
   14. [获取程序状态](#414-state_state_program)  
   15. [获取多个程序状态](#415-state_status_program)
   16. [GPU主机上线](#415-state_join_gpu)
   17. [GPU主机下线](#415-state_disconnect_gpu)

## 1. 安装

首先，安装 Socket.IO 客户端库，具体安装方式取决于您选择的编程语言：

- **JavaScript**: 使用 [socket.io-client](https://github.com/socketio/socket.io-client) 库。
- **Java**: 可以使用 [socket.io-client-java](https://github.com/socketio/socket.io-client-java) 库。
- **C++**: 使用 [socket.io-client-cpp](https://github.com/socketio/socket.io-client-cpp) 库。
- **Swift**: 可以使用 [socket.io-client-swift](https://github.com/socketio/socket.io-client-swift) 库。
- **Dart**: 使用 [socket.io-client-dart](https://github.com/rikulo/socket.io-client-dart) 库。
- **Python**: 可以使用 [python-socketio](https://github.com/miguelgrinberg/python-socketio) 库。
- **.NET**: 使用 [socket.io-client-csharp](https://github.com/doghappy/socket.io-client-csharp) 库。
- **Rust**: 可以使用 [rust-socketio](https://github.com/1c3t3a/rust-socketio) 库。
- **PHP**: 使用 [elephant.io](https://github.com/ElephantIO/elephant.io) 库。

## 2. 连接 Socket.IO 服务器

在代码中，使用 Socket.IO 客户端库连接到引体向上服务的地址，例如：

```javascript
const io = require('socket.io-client');
const socket = io('https://gs.classtao.cn/tools');
```

## 3. 发送消息

客户端可以向服务器发送以下类型的消息，每种消息类型都有其特定的作用和参数要求。

### 3.1. join

**作用：** 发送加入房间的消息。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "roomId":"2e135416c5bbb9d1f6a9be61a1130d1f"
}
```

### 3.2. camera

**作用：** 发送摄像头相关操作的消息。

#### 3.2.1. add

**作用：** 添加摄像头

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，可以是 "add"（添加）或其他自定义操作。|
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| name       | 字符串 (String)| 摄像头名称。                               |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |
| host       | 字符串 (String)| 摄像头的主机地址。                        |
| channel    | 字符串 (String)| 摄像头的通道。                            |
| username   | 字符串 (String)| 登录摄像头的用户名。                      |
| password   | 字符串 (String)| 登录摄像头的密码。                        |
| rtspuser   | 字符串 (String) 或 null | RTSP 用户名（如果适用）。          |
| rtsppswd   | 字符串 (String) 或 null | RTSP 密码（如果适用）。            |
| face       | 字符串 (String) 或 null | 是否开启人脸识别，有值表示开启。    |
| mark       | 数组 (Array)   | 标记点的坐标数组。                        |

**参数示例：**
```json
{
  "action": "add",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
  "name": "公司1",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "host": "192.168.31.142",
  "channel": "1",
  "username": "admin",
  "password": "129289aC!",
  "rtspuser": "hxx",
  "rtsppswd": "129289aC!",
  "face": "face",
  "mark": [[190,916],[797,1045],[92,279],[767,263],[1059,935],[1674,1031],[1074,258],[1748,266]]
}
```

**JavaScript例子：**
```javascript
  // 添加摄像头
  socket.emit("camera", {
    "action": "add",
    "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
    "name": "公司1",
    "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
    "host": "192.168.31.142",
    "channel": "1",
    "username": "admin",
    "password": "129289aC!",
    "rtspuser": "hxx",
    "rtsppswd": "129289aC!",
    "face": "face",
    "mark": [[190,916],[797,1045],[92,279],[767,263],[1059,935],[1674,1031],[1074,258],[1748,266]]
  });
```

#### 3.2.1. delete

**作用：** 删除摄像头

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "delete"。                |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |

**参数示例：**
```json
{
  "action":"delete",
  "roomId":"2e135416c5bbb9d1f6a9be61a1130d1f",
  "cameraId":"de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**JavaScript例子：**
```javascript
  // 添加摄像头
  socket.emit("camera", {
    "action": "delete",
    "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
    "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  });
```
好的，下面是完整的工具服务调用使用文档的后续部分：

---

#### 3.2.3. speak

**作用：** 让摄像头发声

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "speak"。                |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |
| message    | 字符串 (String)| 要发送的喊话内容。                        |

**参数示例：**
```json
{
  "action": "speak",
  "roomId": "2e135416c5bbb9d1f6a9be61a1130d1f",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "txt": "测试音频输出是否正常"
}
```

**JavaScript例子：**
```javascript
// 摄像头喊话
socket.emit("camera", {
  "action": "speak",
  "txt": "测试音频输出是否正常",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
});

```

#### 3.2.4. goto

**作用：** 摄像头转到预设角

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "goto"。                 |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |
| preset     | 字符串 (String)| 预设角的名称。                            |

**参数示例：**
```json
{
  "action": "goto",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "preset": "立定跳远"
}
```

**JavaScript例子：**
```javascript
// 摄像头转到预设角
socket.emit("camera", {
  "action": "goto",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "preset": "立定跳远"
});
```


#### 3.2.5. start_record

**作用：** 开始录像

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "start_record"。         |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |

**参数示例：**
```json
{
  "action": "start_record",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**JavaScript例子：**
```javascript
// 开始录像
socket.emit("camera", {
  "action": "start_record",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
});
```



#### 3.2.6. stop_record

**作用：** 停止录像

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "stop_record"。          |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |

**参数示例：**
```json
{
  "action": "stop_record",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**JavaScript例子：**
```javascript
// 停止录像
socket.emit("camera", {
  "action": "stop_record",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
});
```

#### 3.2.7. frame

**作用：** 截图

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "frame"。                |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |
| cameraId   | 字符串 (String)| 摄像头的唯一标识符。                      |

**参数示例：**
```json
{
  "action": "frame",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
}
```

**JavaScript例子：**
```javascript
// 截图
socket.emit("camera", {
  "action": "frame",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "cameraId": "de40c000-c2d6-11b2-80d2-bc5e33ace640"
});
```


### 3.3. program

**作用：** 发送程序管理相关操作的消息。
已将“分道跑-起点检测”添加到对照表中。现在的对照表如下：

| programId | 项目名称              | 描述          | 状态       |
|-----------|-----------------------|---------------|------------|
| 1         | 立定跳远              | 运动项目描述 | 未开始     |
| 2         | 仰卧起坐              | 运动项目描述 | 未开始     |
| 3         | 仰卧起坐-娱乐版       | 运动项目描述 | 未开始     |
| 4         | 硬体向上              | 运动项目描述 | 未开始     |
| 5         | 立定跳远-异常版       | 运动项目描述 | 未开始     |
| 6         | 分道跑                | 运动项目描述 | 未开始     |
| 7         | 分道跑-起点检测       | 运动项目描述 | 未开始     |

如果还有其他项目或信息需要添加，请告诉我！

#### 3.3.1. start

**作用：** 启动程序

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String) | 操作类型，通常为 "start"。                |
| programId  | 整数 (Integer)  | 程序的唯一标识符。                        |
| roomId     | 字符串 (String) | 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "start",
  "programId": 1,
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**JavaScript例子：**
```javascript
// 启动程序
socket.emit("program", {
  "action": "start",
  "programId": 1,
  "roomId": "77ab1561029ec3645554a71c70701e2c"
});
```

#### 3.3.2. stop

**作用：** 停止程序

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String) | 操作类型，通常为 "stop"。                 |
| programId  | 整数 (Integer)  | 程序的唯一标识符。                        |
| roomId     | 字符串 (String) | 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "stop",
  "programId": 1,
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**JavaScript例子：**
```javascript
// 停止程序
socket.emit("program", {
  "action": "stop",
  "programId": 1,
  "roomId": "77ab1561029ec3645554a71c70701e2c"
});
```

#### 3.3.3. restart

**作用：** 重启程序

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String) | 操作类型，通常为 "restart"。              |
| programId  | 整数 (Integer)  | 程序的唯一标识符。                        |
| roomId     | 字符串 (String) | 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "restart",
  "programId": 1,
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**JavaScript例子：**
```javascript
// 重启程序
socket.emit("program", {
  "action": "restart",
  "programId": 1,
  "roomId": "77ab1561029ec3645554a71c70701e2c"
});
```

#### 3.3.4. status

**作用：** 获取已启动程序的状态

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String) | 操作类型，通常为 "status"。               |
| roomId     | 字符串 (String) | 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "status",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**JavaScript例子：**
```javascript
// 获取已启动程序的状态
socket.emit("program", {
  "action": "status",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
});
```

#### 3.3.5. state

**作用：** 获取指定程序的详细状态

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String) | 操作类型，通常为 "state"。                |
| programId  | 整数 (Integer)  | 程序的唯一标识符。                        |
| roomId     | 字符串 (String) | 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "state",
  "programId": 1,
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**JavaScript例子：**
```javascript
// 获取指定程序的详细状态
socket.emit("program", {
  "action": "state",
  "programId": 1,
  "roomId": "77ab1561029ec3645554a71c70701e2c"
});
```

## 4. 监听消息

客户端可以监听以下类型的消息，以获取服务器发送的状态更新或结果信息。

### 4.1. connect

**作用：** 建立连接。


### 4.2. disconnect

**作用：** 连接断开。


### 4.3. state_add_camera

**作用：** 添加摄像头。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_add"。            |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String) 或 null | 消息，只在状态为 "fail" 时存在。     |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_add",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "success",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_add",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "fail",
  "message": "没有找到对应的摄像头",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.4. state_delete_camera

**作用：** 删除摄像头。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_delete"。         |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String) 或 null | 消息，只在状态为 "fail" 时存在。     |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_delete",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "success",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_delete",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "state": "fail",
  "message": "没有找到对应的摄像头",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.5. state_presets_camera

**作用：** 获取摄像头的预设角列表。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_presets"。        |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String)| 消息，描述请求结果。                      |
| data       | 数组 (Array)   | 包含预设角的信息列表。                     |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_presets",
  "state": "success",
  "message": "预设角列表",
  "data": [
    {"enabled": "true", "id": "1", "presetName": "立定跳远", "AbsoluteHigh": {"elevation": "260", "azimuth": "1718", "absoluteZoom": "17"}},
    {"enabled": "true", "id": "2", "presetName": "仰卧起坐", "AbsoluteHigh": {"elevation": "301", "azimuth": "1802", "absoluteZoom": "17"}},
    {"enabled": "true", "id": "3", "presetName": "引体向上", "AbsoluteHigh": {"elevation": "133", "azimuth": "1742", "absoluteZoom": "13"}},
    {"enabled": "true", "id": "4", "presetName": "测试", "AbsoluteHigh": {"elevation": "484", "azimuth": "1667", "absoluteZoom": "15"}},
    {"enabled": "true", "id": "5", "presetName": "立定跳远1", "AbsoluteHigh": {"elevation": "186", "azimuth": "2063", "absoluteZoom": "15"}},
    {"enabled": "true", "id": "6", "presetName": "跳山羊", "AbsoluteHigh": {"elevation": "490", "azimuth": "1798", "absoluteZoom": "10"}},
    {"enabled": "true", "id": "7", "presetName": "实心球", "AbsoluteHigh": {"elevation": "252", "azimuth": "1568", "absoluteZoom": "13"}},
    {"enabled": "true", "id": "8", "presetName": "摸高", "AbsoluteHigh": {"elevation": "146", "azimuth": "1772", "absoluteZoom": "11"}},
    {"enabled": "true", "id": "9", "presetName": "录像", "AbsoluteHigh": {"elevation": "236", "azimuth": "1876", "absoluteZoom": "10"}},
    {"enabled": "true", "id": "10", "presetName": "前滚翻", "AbsoluteHigh": {"elevation": "490", "azimuth": "1798", "absoluteZoom": "10"}}
  ],
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_presets",
  "state": "fail",
  "message": "未能获取预设角列表",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.6. state_frame_camera

**作用：** 获取摄像头的截图状态。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_frame"。          |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String)| 消息，描述请求结果，仅在失败时存在。     |
| url        | 字符串 (String)| 成功时返回截图的 URL。                    |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_frame",
  "state": "success",
  "url": "https://zhihuicaochang.oss-cn-hangzhou.aliyuncs.com/record/mark1727342585874.jpg",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_frame",
  "state": "fail",
  "message": "没有找到对应的摄像头",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.7. state_upload_record_camera

**作用：** 监听录制视频上传的进度。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_upload_record"。  |
| process    | 数字 (Number)  | 上传进度百分比（0-100）。                 |
| current    | 数字 (Number)  | 当前已上传的数据量（字节）。              |
| total      | 数字 (Number)  | 总数据量（字节）。                        |
| sport      | 字符串 (String)| 运动类型或相关信息。                      |
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例：**
```json
{
  "action": "state_upload_record",
  "process": 20,
  "current": 147456,
  "total": 733546,
  "sport": "tools",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.8. state_record_end_camera

**作用：** 监听录像结束的状态和视频链接。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_record_end"。     |
| video_url  | 字符串 (String)| 录像结束后视频的链接。                    |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_record_end",
  "video_url": "https://zhihuicaochang.oss-cn-hangzhou.aliyuncs.com/record/1873e511bf4a2e14f7230dbb3a532bc3record.mp4",
  "state": "success",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_record_end",
  "video_url": null,
  "state": "fail",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "message": "录像过程中发生错误"
}
```

### 4.9. state_start_record_camera

**作用：** 监听录像开始的状态。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                       |
|------------|----------------|--------------------------------------------|
| action     | 字符串 (String)| 操作类型，通常为 "state_start_record"。   |
| name       | 字符串 (String)| 录像文件的名称。                          |
| state      | 字符串 (String)| 状态，可以是 "success"（成功）或 "fail"（失败）。|
| id         | 字符串 (String)| 摄像头的唯一标识符。                      |
| roomId     | 字符串 (String)| 房间的唯一标识符。                        |

**参数示例（成功）：**
```json
{
  "action": "state_start_record",
  "name": "1873e511bf4a2e14f7230dbb3a532bc3record.mp4",
  "state": "success",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_start_record",
  "name": null,
  "state": "fail",
  "id": "de40c000-c2d6-11b2-80d2-bc5e33ace640",
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "message": "录像开始失败"
}
```

### 4.10. state_join

**作用：** 监听房间接入的状态。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                        |
|------------|----------------|---------------------------------------------|
| roomId     | 字符串 (String) | 房间的唯一标识符。                          |
| state      | 字符串 (String) | 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String) | 接入状态的附加消息，描述接入的详细信息。     |

**成功示例：**
```json
{
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "state": "success",
  "message": "接入成功"
}
```

**失败示例：**
```json
{
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "state": "fail",
  "message": "接入失败，网络异常"
}
```

### 4.11. state_start_program

**作用：** 监听程序启动的状态。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                        |
|------------|----------------|---------------------------------------------|
| action     | 字符串 (String) | 操作类型，通常为 "state_start"。             |
| programId  | 整数 (Integer)  | 启动程序的唯一标识符。                       |
| state      | 字符串 (String) | 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String) | 程序启动的附加消息，描述启动结果的详细信息。   |
| roomId     | 字符串 (String) | 房间的唯一标识符。                           |

**参数示例（成功）：**
```json
{
  "action": "state_start",
  "programId": 1,
  "state": "success",
  "message": "启动程序成功",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_start",
  "programId": 1,
  "state": "fail",
  "message": "启动程序失败",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.12. state_stop_program

**作用：** 监听程序停止的状态。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                        |
|------------|----------------|---------------------------------------------|
| action     | 字符串 (String) | 操作类型，通常为 "state_stop"。              |
| programId  | 整数 (Integer)  | 停止程序的唯一标识符。                       |
| state      | 字符串 (String) | 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String) | 程序停止的附加消息，描述停止结果的详细信息。   |
| roomId     | 字符串 (String) | 房间的唯一标识符。                           |

**参数示例（成功）：**
```json
{
  "action": "state_stop",
  "programId": 1,
  "state": "success",
  "message": "停止程序成功",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_stop",
  "programId": 1,
  "state": "fail",
  "message": "停止程序失败",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.13. state_restart_program

**作用：** 监听程序重启的状态。

**参数字段说明：**

| 参数字段   | 类型           | 说明                                        |
|------------|----------------|---------------------------------------------|
| action     | 字符串 (String) | 操作类型，通常为 "state_restart"。           |
| programId  | 整数 (Integer)  | 重启程序的唯一标识符。                       |
| state      | 字符串 (String) | 状态，可以是 "success"（成功）或 "fail"（失败）。|
| message    | 字符串 (String) | 程序重启的附加消息，描述重启结果的详细信息。   |
| roomId     | 字符串 (String) | 房间的唯一标识符。                           |

**参数示例（成功）：**
```json
{
  "action": "state_restart",
  "programId": 1,
  "state": "success",
  "message": "重启程序成功",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_restart",
  "programId": 1,
  "state": "fail",
  "message": "重启程序失败",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.14. state_state_program

**作用：** 获取程序当前状态信息。

**参数字段说明：**

| 参数字段   | 类型             | 说明                                        |
|------------|------------------|---------------------------------------------|
| action     | 字符串 (String)   | 操作类型，通常为 "state_state"。             |
| programId  | 整数 (Integer)    | 程序的唯一标识符。                           |
| state      | 字符串 (String)   | 状态，可以是 "success"（成功）或 "fail"（失败）。|
| data       | 对象 (Object)     | 包含程序的详细状态信息。                     |
| data.pid   | 整数 (Integer)    | 进程ID（PID）。                              |
| data.id    | 整数 (Integer)    | 程序的唯一标识符。                           |
| data.status| 字符串 (String)   | 程序的当前状态，如 "运行中"。                 |
| data.script_path | 字符串 (String)| 脚本的路径。                              |
| data.name  | 字符串 (String)   | 程序的名称。                                 |
| message    | 字符串 (String)   | 说明当前状态的附加信息。                     |
| roomId     | 字符串 (String)   | 房间的唯一标识符。                           |

**参数示例（成功）：**
```json
{
  "action": "state_state",
  "programId": 1,
  "state": "success",
  "data": {
    "pid": 5536,
    "id": 1,
    "status": "运行中",
    "script_path": "D:\\ai\\tiaoyuan\\index.pyc",
    "name": "立定跳远"
  },
  "message": "成功",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_state",
  "programId": 1,
  "state": "fail",
  "message": "获取程序状态失败",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.15. state_status_program

**作用：** 获取多个程序的状态信息。

**参数字段说明：**

| 参数字段      | 类型             | 说明                                        |
|---------------|------------------|---------------------------------------------|
| action        | 字符串 (String)   | 操作类型，通常为 "state_status"。            |
| state         | 字符串 (String)   | 状态，可以是 "success"（成功）或 "fail"（失败）。|
| data          | 数组 (Array)      | 包含多个程序的状态信息。                     |
| data[].pid    | 整数 (Integer)    | 进程ID（PID）。                              |
| data[].id     | 整数 (Integer)    | 程序的唯一标识符。                           |
| data[].status | 字符串 (String)   | 程序的当前状态，如 "运行中"。                 |
| data[].script_path | 字符串 (String)| 脚本的路径。                               |
| data[].name   | 字符串 (String)   | 程序的名称。                                 |
| message       | 字符串 (String)   | 说明当前状态的附加信息。                     |
| roomId        | 字符串 (String)   | 房间的唯一标识符。                           |

**参数示例（成功）：**
```json
{
  "action": "state_status",
  "state": "success",
  "data": [
    {
      "pid": 5536,
      "id": 1,
      "status": "运行中",
      "script_path": "D:\\ai\\tiaoyuan\\index.pyc",
      "name": "立定跳远"
    }
  ],
  "message": "成功",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

**参数示例（失败）：**
```json
{
  "action": "state_status",
  "state": "fail",
  "message": "获取程序状态失败",
  "roomId": "77ab1561029ec3645554a71c70701e2c"
}
```

### 4.16. state_join_gpu

**作用：** 监听GPU主机上线的状态

**参数字段说明：**

| 参数字段   | 类型           | 说明                                        |
|------------|----------------|---------------------------------------------|
| roomId     | 字符串 (String) | 房间的唯一标识符。                          |
| message    | 字符串 (String) | 主机上线时的附加消息，描述上线的详细信息。   |

**参数示例（成功）：**
```json
{
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "message": "上线了"
}
```

### 4.17. state_disconnect_gpu

**作用：** 监听GPU主机下线的状态

**参数字段说明：**

| 参数字段   | 类型           | 说明                                        |
|------------|----------------|---------------------------------------------|
| roomId     | 字符串 (String) | 房间的唯一标识符。                          |
| message    | 字符串 (String) | 主机下线时的附加消息，描述下线的详细信息。   |

**参数示例（成功）：**
```json
{
  "roomId": "77ab1561029ec3645554a71c70701e2c",
  "message": "掉线了"
}
```




```html
<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"
    />
    <title>工具</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.3.2/socket.io.js"></script>
    <style>
      #roomId {
        width: 60%;
        height: 65px;
        font-size: 24px;
        margin: 5px;
      }
      #join {
        position: absolute;
        width: 30%;
        height: 72px;
        font-size: 24px;
        margin: 5px;
      }
      #start {
        width: 80%;
        height: 100px;
        font-size: 32px;
        margin: 20px 10% 10px;
      }
      #end {
        width: 80%;
        height: 100px;
        font-size: 32px;
        margin: 10px 10%;
      }
      .scores-box {
        width: 80%;
        /* height: 200px; */
        margin: 50px 10%;
        text-align: center;
        position: relative;
      }
      .scores-container {
        width: 100%;
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        grid-template-rows: repeat(3, 1fr);
      }
      .scores-container .scores-item {
        border: 1px solid #000;
      }
      .scores-item .item-title {
        font-size: 20px;
        text-align: center;
        line-height: 80px;
      }
      .scores-item .item-pic {
        width: 100px;
        height: 100px;
      }
      .scores-item .item-score {
        font-size: 32px;
        text-align: center;
        line-height: 80px;
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }

      table,
      td,
      th {
        border: 1px solid black;
        height: 50px;
      }
    </style>
  </head>
  <body>
    <div id="app">
      <input id="roomId" type="text" v-model="roomId" />
      <button id="join" @click="onJoin">join</button>
      <div style="position: relative">
        <fieldset style="width: 50%; margin: 5px">
          <legend>选择摄像头：</legend>
          <label v-for="camera in cameras" :key="camera.cameraId">
            <input
              type="checkbox"
              :id="camera.cameraId"
              :value="camera.cameraId"
              v-model="selectedCameras"
            />
            {{ camera.name }}
            <br />
          </label>
        </fieldset>
        <button
          style="
            position: absolute;
            top: 0;
            right: 40%;
            height: 100%;
            width: 20%;
            font-size: 32px;
          "
          @click="onAddCamera"
        >
          add
        </button>
        <button
          style="
            position: absolute;
            top: 0;
            right: 20%;
            height: 100%;
            width: 20%;
            font-size: 32px;
          "
          @click="onGetFrame"
        >
          frame
        </button>
        <button
          style="
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 20%;
            font-size: 32px;
          "
          @click="onRecord"
        >
          {{record_btn_name}}
        </button>
      </div>
      <div style="position: relative">
        <fieldset style="width: 50%; margin: 5px">
          <legend>选择预设角：</legend>
          <label v-for="preset in presets" :key="preset">
            <input
              type="checkbox"
              :id="preset"
              :value="preset"
              v-model="selectedPresets"
            />
            {{ preset }}
            <br />
          </label>
        </fieldset>
        <button
          style="
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 30%;
            font-size: 32px;
          "
          @click="onGoto"
        >
          转到
        </button>
      </div>

      <div style="position: relative">
        <fieldset style="width: 50%; margin: 5px">
          <legend>选择程序：</legend>
          <label v-for="program in programs" :key="program.id">
            <input
              type="checkbox"
              :id="program.id"
              :value="program.id"
              v-model="selectedProgram"
              @change="onProgramChange(program.id)"
            />
            {{ program.name }}
            <br />
          </label>
        </fieldset>
        <button
          style="
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 30%;
            font-size: 32px;
          "
          @click="onRestartProgram"
        >
          重启
        </button>
      </div>

      <div style="position: relative;height: 80px;">
        <label for="programs">选择一个程序：</label>
        <select v-model="selectedStateProgram" id="programs">
          <option
            v-for="program in programs"
            :key="program.id"
            :value="program.id"
          >
            {{ program.name }}
          </option>
        </select>
        <button
          style="
            position: absolute;
            top: 0;
            right: 0;
            height: 100%;
            width: 40%;
            font-size: 32px;
          "
          @click="onStateProgram"
        >
          查询单个程序的状态
        </button>
      </div>

      <div style="position: relative">
        <input id="roomId" type="text" v-model="txt" />
        <button id="join" @click="onSpeak">speak</button>
      </div>

      <button id="end" @click="onDelete">删除!</button>
      <div class="scores-box">
        <h1>视频录制:{{time}}</h1>
        <progress id="progressBar" :value="process" max="100">
          视频上传进度
        </progress>

        <video :src="url" controls style="width: 90%"></video>
      </div>
      <div v-if="!!markFrame" class="scores-box">
        <img style="width: 100%" :src="markFrame" alt="标记图片" />
      </div>
    </div>

    <script>
      var socket = io("wss://gs.classtao.cn/tools", {
        transports: ["websocket"],
      });
      // var socket = io("ws://127.0.0.1:8080/tools", {
      //   transports: ["websocket"],
      // });

      const speak = function (text) {
        if (text) {
          var speechSynthesis = window.speechSynthesis;
          speechSynthesis.cancel();
          var speechUtterance = new SpeechSynthesisUtterance(text);
          speechSynthesis.speak(speechUtterance);
        }
      };
      var app = new Vue({
        el: "#app",
        filters: {
          parselocaltime(value) {
            const utcDate = new Date(value * 1000);
            const localDate = utcDate.toLocaleString();
            return localDate;
          },
        },
        data: {
          markFrame: "",
          record_btn_name: "start_record",
          presets: ["立定跳远"],
          programs: [
            {
              id: 1,
              name: "立定跳远",
            },
            {
              id: 2,
              name: "仰卧起坐",
            },
            {
              id: 3,
              name: "仰卧起坐-娱乐版",
            },
            {
              id: 4,
              name: "引体向上",
            },
            {
              id: 5,
              name: "立定跳远-异常版",
            },
            {
              id: 6,
              name: "分道跑",
            },
            {
              id: 7,
              name: "分道跑-起点检测",
            },
          ],
          txt: "测试音频输出是否正常",
          cameras: [
            {
              name: "公司一",
              roomId: "77ab1561029ec3645554a71c70701e2c",
              cameraId: "de40c000-c2d6-11b2-80d2-bc5e33ace640",
              host: "192.168.31.142",
              channel: "1",
              username: "admin",
              password: "129289aC!",
              rtspuser: "hxx",
              rtsppswd: "129289aC!",
              mark: [
                [1102, 565],
                [1763, 982],
              ],
            },
            {
              name: "公司二",
              roomId: "25c570d7f0225c542c2855089e165dcd",
              cameraId: "7f8b4000-f0c2-11b4-8398-3c1bf8d0d11a",
              host: "192.168.31.155",
              channel: "1",
              username: "admin",
              password: "129289aC!",
              rtspuser: "hxx",
              rtsppswd: "129289aC!",
              mark: [
                [1102, 565],
                [1763, 982],
              ],
            },
            {
              name: "4060Ti",
              roomId: "34cb7198202f73c1df6ee51d30213201",
              cameraId: "461ac000-9a52-11b4-832a-a0ff0cfbced7",
              host: "172.17.1.189",
              channel: "1",
              username: "admin",
              password: "129289aC!",
              rtspuser: "hxx",
              rtsppswd: "129289aC!",
              mark: [
                [1033, 110],
                [1491, 966],
                [1109, 226],
                [1424, 226],
              ],
            },
          ],
          selectedCameras: [], // 用于存储选择的摄像头
          selectedPresets: [],
          selectedProgram: [],
          selectedStateProgram: 1,
          scores: [],
          time: 0,
          isBegin: true,
          roomId: "185410950663306",
          process: 0,
          url: "",
        },
        mounted() {
          socket.on("connect", function () {
            console.log("Connected to server");
          });

          socket.on("disconnect", function () {
            console.log("disconnect to server");
          });

          socket.on("state_join", function () {
            socket.emit("program", {
              action: "status",
              roomId: app.roomId,
            });
          });

          socket.on("state_state_program", function (data) {
            alert(JSON.stringify(data))
          });

          socket.on("state_start_program", function (data) {
            speak(data.message);
          });

          socket.on("state_stop_program", function (data) {
            speak(data.message);
          });

          socket.on("state_restart_program", function (data) {
            speak(data.message);
          });

          socket.on("state_status_program", function (data) {
            selectedProgram = []
            for(p of data.data){
              selectedProgram.push(p.id)
            }
            app.selectedProgram = selectedProgram
          });

          socket.on("state_add_camera", function (data) {
            console.log(data);
            if (data.state === "success") {
              speak("摄像头添加成功");
            } else {
              speak(data.msg);
            }
          });

          //state_presets_camera
          socket.on("state_presets_camera", function (data) {
            console.log(data);
            s = new Set();
            for (const p of app.presets) {
              s.add(p);
            }
            for (const iterator of data.data) {
              console.log(iterator.presetName);
              s.add(iterator.presetName);
            }
            app.presets = Array.from(s);
          });

          socket.on("state_delete_camera", function (data) {
            console.log(data);
            if (data.state === "success") {
              speak("摄像头删除成功");
            } else {
              speak("摄像头删除失败");
              console.log(data.msg);
            }
          });

          //state_frame_camera
          socket.on("state_frame_camera", function (data) {
            console.log(data);
            // speak("开始标记吧");
            app.markFrame = data.url;
          });

          //upload_determine
          socket.on("upload_determine", function (data) {
            app.process = data.process;
          });
          //state_upload_record_camera
          socket.on("state_upload_record_camera", function (data) {
            app.process = data.process;
          });
          //state_record_end_camera
          socket.on("state_record_end_camera", function (data) {
            app.url = data.video_url;
          });
        },
        methods: {
          onStateProgram(){
            socket.emit("program", {
              action: "state",
              programId: this.selectedStateProgram,
              roomId: app.roomId,
            });
          },
          onRestartProgram() {
            for (id of this.selectedProgram) {
              socket.emit("program", {
                action: "restart",
                programId: id,
                roomId: app.roomId,
              });
            }
          },
          onProgramChange(id) {
            if (this.selectedProgram.includes(id)) {
              console.log(`Program with id ${id} selected.`);
              socket.emit("program", {
                action: "start",
                programId: id,
                roomId: app.roomId,
              });
            } else {
              console.log(`Program with id ${id} deselected.`);
              socket.emit("program", {
                action: "stop",
                programId: id,
                roomId: app.roomId,
              });
            }
          },
          getCamera() {
            if (this.selectedPresets.length > 1) {
              alert("只能选一个位置");
              return;
            }
            for (cameraId of this.selectedCameras) {
              for (camera of this.cameras) {
                if (camera.cameraId == cameraId) {
                  return camera;
                }
              }
            }
          },
          onSpeak() {
            camera = this.getCamera();
            socket.emit("camera", {
              action: "speak",
              txt: this.txt,
              roomId: app.roomId,
              cameraId: camera.cameraId,
            });
          },
          onDelete() {
            for (cameraId of this.selectedCameras) {
              // 删除摄像头
              socket.emit("camera", {
                action: "delete",
                roomId: app.roomId,
                cameraId: cameraId,
              });
            }
          },
          onAddCamera() {
            if (this.selectedCameras.length < 1) {
              alert("最少添加一个摄像头");
              return;
            }
            for (cameraId of this.selectedCameras) {
              for (camera of this.cameras) {
                if (camera.cameraId == cameraId) {
                  // 添加摄像头
                  socket.emit("camera", {
                    action: "add",
                    roomId: app.roomId,
                    ...camera,
                  });
                }
              }
            }
          },
          onGoto() {
            if (this.selectedPresets.length > 1) {
              alert("只能选一个位置");
              return;
            }
            for (cameraId of this.selectedCameras) {
              for (camera of this.cameras) {
                if (camera.cameraId == cameraId) {
                  //开始录制视频
                  socket.emit("camera", {
                    action: "goto",
                    roomId: app.roomId,
                    cameraId: cameraId,
                    preset: this.selectedPresets[0],
                  });
                }
              }
            }
          },
          onRecord() {
            if (this.selectedCameras.length < 1) {
              alert("最少添加一个摄像头");
              return;
            }
            if (this.record_btn_name === "start_record") {
              for (cameraId of this.selectedCameras) {
                for (camera of this.cameras) {
                  if (camera.cameraId == cameraId) {
                    //开始录制视频
                    socket.emit("camera", {
                      action: "start_record",
                      roomId: app.roomId,
                      cameraId: cameraId,
                    });
                  }
                }
              }
              this.record_btn_name = "stop_record";
            } else {
              for (cameraId of this.selectedCameras) {
                for (camera of this.cameras) {
                  if (camera.cameraId == cameraId) {
                    //开始录制视频
                    socket.emit("camera", {
                      action: "stop_record",
                      roomId: app.roomId,
                      cameraId: cameraId,
                    });
                  }
                }
              }
              this.record_btn_name = "start_record";
            }
          },
          onGetFrame() {
            if (this.selectedCameras.length === 1) {
              for (cameraId of this.selectedCameras) {
                //mark 跳远毯,获取画面截图
                socket.emit("camera", {
                  action: "frame",
                  roomId: app.roomId,
                  cameraId: cameraId,
                });
              }
            } else {
              alert("获取截图只能选择一个摄像头");
            }
          },
          onJoin() {
            for (cameraId of this.selectedCameras) {
              for (camera of this.cameras) {
                if (camera.cameraId == cameraId) {
                  app.roomId = camera.roomId;
                  socket.emit("join", { roomId: app.roomId });
                  return;
                }
              }
            }
          },
        },
      });
    </script>
  </body>
</html>


```
